#!/bin/bash
# jul 2015

j() {
  local a y m
  ((a=(14-$2)/12,y=$1+4800-a,m=$2+12*a-3))
  echo $(($3+(153*m+2)/5+365*y+y/4-y/100+y/400-32045))
}

g() {
  local l n i j y m d
  ((l=$1+68569,n=4*l/146097,l=l-(146097*n+3)/4,i=4000*(l+1)/1461001,
    l=l-(1461*i)/4+31,j=(80*l)/2447,d=l-2447*j/80,l=j/11,m=j+2-12*l,
    y=100*(n-49)+i+l
  ))
  printf %04d-%02d-%02d\\n $y $m $d
}

# small test
y=2000 m=3 d=1;
for i in {1..-1}; do
  g $(($(j "$y" "$m" "$d")+i))
done
